import os
import json
import re
from mistralai import Mistral

api_key = 'ZKbEjFJRvPUgLGSL6QJOiJr9j2W2dJFA'
model = "mistral-large-latest"

client = Mistral(api_key=api_key)

system_message = {
    "role": "system",
    "content": (
        "You will receive a JSON file containing multiple items. Each item includes keywords such as 'category' (e.g., activity/lunch/dinner),'title','rating','address','operating hours', and 'discription'. In addition to the JSON file, you will also be given the number of travel days and the starting date. "
        "First, you need to summarize the discription and the rating for each item. Then, based on the number of travel days, the starting date, and the summary you made, you will create a travel plan for the user. "
        "The travel plan should include: 'date', 'starting time', 'end time', 'title', and 'description' (which is the summary you made). "
        "Ensure that each day includes lunch and dinner activities. "
        "When planning each place, you need to consider the address of each title and the commute time from title to title. Try to avoid scheduling two titles that are far apart consecutively, and make sure to account for commute time in the starting time and ending time. Each interval between itineraries should not exceed one hour. "
        "Each title's description should be around 50 words. "
        "The output should follow this format: '{\n  \"days\": [\n    {\n      \"day\": \"Day X\",\n      \"date\": \"YYYY-MM-DD\",\n      \"itineraries\": [\n        {\n          \"starting_time\": \"HH:MM AM/PM\",\n          \"end_time\": \"HH:MM AM/PM\",\n          \"title\": \"Title of the place\",\n          \"description\": \"Description of the place\"\n        },\n        {\n          \"starting_time\": \"HH:MM AM/PM\",\n          \"end_time\": \"HH:MM AM/PM\",\n          \"title\": \"Title of the place\",\n          \"description\": \"Description of the place\"\n        }\n        // Add as many itineraries as needed for the day\n      ]\n    },\n    {\n      \"day\": \"Day X\",\n      \"date\": \"YYYY-MM-DD\",\n      \"itineraries\": [\n        {\n          \"starting_time\": \"HH:MM AM/PM\",\n          \"end_time\": \"HH:MM AM/PM\",\n          \"title\": \"Title of the place\",\n          \"description\": \"Description of the place\"\n        }\n        // Add more itineraries if needed\n      ]\n    }\n    // Add as many days as needed\n  ]\n}'"
    )
}



# Template for extracting elements from the extracted_info dictionary
extracted_info = {
    'days': 5,
    'startingDate': '2024-10-05',
    'json': {
        # Example JSON structure
        'items': [[{"data_id":"0x48760349331f38dd:0xa8bf49dde1d56467","category":"activities","position":1,"title":"Tower of London","gps_coordinates":{"latitude":51.508112399999995,"longitude":-0.0759493},"rating":4.7,"reviews":107082,"types":["Castle","Conference center","Historical place","Landmark","Tourist attraction"],"address":"London, EC3N 4AB, United Kingdom","operating_hours":{"saturday":"9 AM–5:30 PM","sunday":"10 AM–5:30 PM","monday":"10 AM–5:30 PM","tuesday":"9 AM–5:30 PM","wednesday":"9 AM–5:30 PM","thursday":"9 AM–5:30 PM","friday":"9 AM–5:30 PM"},"description":"Medieval castle housing the Crown Jewels. Centuries of bloody history around a medieval castle, home to Crown Jewels and iconic Beefeaters."},{"data_id":"0x487604c70bc8d293:0x39108cb6fa0e39d9","category":"activities","position":2,"title":"The London Dungeon","gps_coordinates":{"latitude":51.502511899999995,"longitude":-0.11876279999999999},"rating":4.3,"reviews":18215,"types":["Haunted house","Tourist attraction"],"address":"Riverside Building, County Hall, Westminster Bridge Rd, London SE1 7PB, United Kingdom","operating_hours":{"saturday":"10 AM–6 PM","sunday":"10 AM–4 PM","monday":"11 AM–4 PM","tuesday":"11 AM–4 PM","wednesday":"11 AM–4 PM","thursday":"11 AM–4 PM","friday":"11 AM–4 PM"},"description":"Hi-tech haunted house attraction. Costumed actors & themed fairground rides depicting macabre stories from London's past."},{"data_id":"0x487604b900d26973:0x4291f3172409ea92","category":"activities","position":3,"title":"lastminute.com London Eye","gps_coordinates":{"latitude":51.5031864,"longitude":-0.11951919999999999},"rating":4.5,"reviews":179413,"types":["Ferris wheel","Tourist attraction"],"address":"Riverside Building, County Hall, London SE1 7PB, United Kingdom","operating_hours":{"saturday":"11 AM–6 PM","sunday":"11 AM–6 PM","monday":"11 AM–6 PM","tuesday":"11 AM–6 PM","wednesday":"11 AM–6 PM","thursday":"11 AM–6 PM","friday":"11 AM–6 PM"}},{"data_id":"0x487604b900d26973:0x10b3051c5b6e29be","category":"activities","position":4,"title":"SEA LIFE London Aquarium","gps_coordinates":{"latitude":51.501557999999996,"longitude":-0.119506},"rating":4.3,"reviews":25864,"types":["Aquarium","Tourist attraction"],"address":"Riverside Building, County Hall, Westminster Bridge Rd, London SE1 7PB, United Kingdom","operating_hours":{"saturday":"10 AM–6 PM","sunday":"10 AM–5 PM","monday":"10 AM–4 PM","tuesday":"10 AM–4 PM","wednesday":"10 AM–4 PM","thursday":"11 AM–4 PM","friday":"10 AM–4 PM"},"description":"Oceanic exhibits for all ages. Family-friendly exhibits with a variety of sea creatures (most offer play areas & group packages)."},{"data_id":"0x48760350b353b80d:0x785d094a4e2363fb","category":"activities","position":5,"title":"The View from The Shard","gps_coordinates":{"latitude":51.5044028,"longitude":-0.0865331},"rating":4.6,"reviews":6531,"types":["Scenic spot","Tourist attraction"],"address":"32 London Bridge St, London, SE1 9SG, United Kingdom","operating_hours":{"saturday":"10 AM–10 PM","sunday":"12–8 PM","monday":"Closed","tuesday":"Closed","wednesday":"12–8 PM","thursday":"12–8 PM","friday":"12–8 PM"},"description":"London's highest viewing platform. Panoramic views of up to 40 miles with a good visibility guarantee (or you visit again for free)."},{"data_id":"0x48761b323093d307:0x2fb199016d5642a7","category":"activities","position":6,"title":"The British Museum","gps_coordinates":{"latitude":51.5194133,"longitude":-0.1269566},"rating":4.7,"reviews":154485,"types":["Museum","Tourist attraction"],"address":"Great Russell St, London, WC1B 3DG, United Kingdom","operating_hours":{"saturday":"10 AM–5 PM","sunday":"10 AM–5 PM","monday":"10 AM–5 PM","tuesday":"10 AM–5 PM","wednesday":"10 AM–5 PM","thursday":"10 AM–5 PM","friday":"10 AM–8:30 PM"},"description":"Museum housing many famous antiquities. Huge showcase for global antiquities, including Egyptian mummies and ancient Greek sculptures."},{"data_id":"0x48760350c17706eb:0x13801321dc693585","category":"activities","position":7,"title":"The London Bridge Experience & London Tombs","gps_coordinates":{"latitude":51.5064486,"longitude":-0.0884586},"rating":4.2,"reviews":1593,"types":["Tourist attraction","Haunted house","Heritage building","Heritage museum","Historical landmark","History museum","Museum","Theme park","Visitor center"],"address":"The Rennie Vaults, 2 - 4 Tooley St, London SE1 2SY, United Kingdom","operating_hours":{"saturday":"11 AM–6 PM","sunday":"11 AM–6 PM","monday":"12–6 PM","tuesday":"12–6 PM","wednesday":"12–6 PM","thursday":"12–6 PM","friday":"12–6 PM"},"description":"Theatrical performances, tours & a maze. Costumed actors perform scenes from London's history at this immersive theatrical showcase."},{"data_id":"0x48760520cd5b5eb5:0xa26abf514d902a7","category":"activities","position":8,"title":"Buckingham Palace","gps_coordinates":{"latitude":51.501363999999995,"longitude":-0.14189},"rating":4.5,"reviews":173132,"types":["Cultural landmark","Historical landmark","Tourist attraction"],"address":"London, SW1A 1AA, United Kingdom","description":"Home of British monarch & State Rooms. Visitors can tour the palace's opulent private and state rooms or watch the changing of the guard."},{"data_id":"0x48761ad73297f857:0xb1723f26e03c12a8","category":"activities","position":9,"title":"London Zoo","gps_coordinates":{"latitude":51.535287499999995,"longitude":-0.1534303},"rating":4.3,"reviews":31394,"types":["Zoo","Tourist attraction"],"address":"Outer Cir, London, NW1 4RY, United Kingdom","operating_hours":{"saturday":"10 AM–5 PM","sunday":"10 AM–5 PM","monday":"10 AM–5 PM","tuesday":"10 AM–5 PM","wednesday":"10 AM–5 PM","thursday":"10 AM–5 PM","friday":"10 AM–5 PM"},"description":"Gorillas, giraffes, penguins & tigers. Major city zoo and research centre helping to conserve numerous species in naturalistic habitats."},{"data_id":"0x487604c40c8d9b99:0x7797a8ef74e1f7c","category":"activities","position":10,"title":"Palace of Westminster","gps_coordinates":{"latitude":51.4994794,"longitude":-0.1248092},"rating":4.6,"reviews":4409,"types":["Government office","Tourist attraction"],"address":"London, SW1A 0AA, United Kingdom","description":"Iconic home of UK parliament. Neo-Gothic masterpiece & seat of the UK government. Guided tours on Saturdays & in the summer."}],[{"data_id":"0x4876057bfdc4509f:0xae7716829398dce8","category":"lunch","position":1,"title":"HIDE","gps_coordinates":{"latitude":51.5061931,"longitude":-0.1444369},"rating":4.5,"reviews":3053,"types":["Modern European restaurant","Fine dining restaurant","Restaurant"],"address":"85 Piccadilly, London, W1J 7NB, United Kingdom","operating_hours":{"saturday":"9–11:15 AM","sunday":"9–11:15 AM","monday":"7–10:45 AM","tuesday":"7–10:45 AM","wednesday":"7–10:45 AM","thursday":"7–10:45 AM","friday":"7–10:45 AM"},"description":"All-day, modern European restaurant. A three floor space in a contemporary setting with elevated morning to late-night dining options.","service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x487604cae7c2496d:0xb6ad06d63e339ce2","category":"lunch","position":2,"title":"Rules","gps_coordinates":{"latitude":51.510833,"longitude":-0.1231694},"rating":4.5,"reviews":2652,"types":["British restaurant","Bar","Country food restaurant","English restaurant","Meat dish restaurant","Traditional restaurant"],"address":"34-35 Maiden Ln, London, WC2E 7LB, United Kingdom","operating_hours":{"saturday":"12–11 PM","sunday":"12–10 PM","monday":"Closed","tuesday":"12–10 PM","wednesday":"12–10 PM","thursday":"12–10 PM","friday":"12–11 PM"},"description":"British menu at city's oldest restaurant. Established in 1798, serving classic British food (especially game) in Edwardian surrounds.","service_options":{"dine_in":True,"takeout":True,"delivery":False}},{"data_id":"0x48761cba02358bc5:0xe77da8b93c776df8","category":"lunch","position":3,"title":"Dishoom Shoreditch","gps_coordinates":{"latitude":51.524615,"longitude":-0.07707499999999999},"rating":4.8,"reviews":28463,"types":["Indian restaurant"],"address":"7 Boundary St, London, E2 7JE, United Kingdom","operating_hours":{"saturday":"9 AM–12 AM","sunday":"9 AM–11 PM","monday":"8 AM–11 PM","tuesday":"8 AM–11 PM","wednesday":"8 AM–11 PM","thursday":"8 AM–12 AM","friday":"8 AM–12 AM"},"description":"Indian menu in hip Bombay-style cafe. Buzzy destination for Indian street food in Bombay-style digs with vintage decor & upscale touches.","service_options":{"dine_in":True,"curbside_pickup":True,"delivery":False}},{"data_id":"0x48761b2b657c41e5:0x5593682c9b218977","category":"lunch","position":4,"title":"Berners Tavern","gps_coordinates":{"latitude":51.5166544,"longitude":-0.1361045},"rating":4.5,"reviews":2192,"types":["British restaurant","Fine dining restaurant","Modern British restaurant"],"address":"10 Berners St, London, W1T 3NP, United Kingdom","operating_hours":{"saturday":"7–10:45 AM","sunday":"7–10 AM","monday":"7–10 AM","tuesday":"7–10 AM","wednesday":"7–10 AM","thursday":"7–10 AM","friday":"7–10 AM"},"description":"Upmarket British food in designer hotel. Jason Atherton's upmarket Modern British restaurant in Ian Schrager's London Edition Hotel.","service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x4876101d34506f7b:0x8e76a34fff31a9e4","category":"lunch","position":5,"title":"The Ledbury","gps_coordinates":{"latitude":51.516655,"longitude":-0.200063},"rating":4.7,"reviews":1504,"types":["Modern European restaurant","Fine dining restaurant"],"address":"127 Ledbury Rd, London, W11 2AQ, United Kingdom","operating_hours":{"saturday":"12–1:30 PM","sunday":"Closed","monday":"Closed","tuesday":"6–9:15 PM","wednesday":"6–9:15 PM","thursday":"6–9:15 PM","friday":"12–1:30 PM"},"description":"Innovative French fare in tranquil space. Chef Brett Graham's innovative cooking, paired with fine wines in a smart, modern setting.","service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x48760ff95f106941:0x1460d2b3cdb1e65a","category":"lunch","position":6,"title":"The Shed","gps_coordinates":{"latitude":51.509021499999996,"longitude":-0.19381009999999999},"rating":4.6,"reviews":1711,"types":["British restaurant","Country food restaurant","European restaurant","Fine dining restaurant","Modern British restaurant","Modern European restaurant","Small plates restaurant"],"address":"122 Palace Gardens Terrace, London, W8 4RT, United Kingdom","operating_hours":{"saturday":"12–11:30 PM","sunday":"Closed","monday":"5–11:30 PM","tuesday":"12–3 PM","wednesday":"12–3 PM","thursday":"12–3 PM","friday":"12–3 PM"},"description":"Seasonal, modern British small plates. Seasonal, modern British plates served in a rustic space with colourful fabrics and barrel tables.","service_options":{"dine_in":True,"takeout":True,"no_contact_delivery":True}},{"data_id":"0x487604d15cac84af:0x5e1284e7a3e3e42b","category":"lunch","position":7,"title":"Scully St James's","gps_coordinates":{"latitude":51.508665,"longitude":-0.1330131},"rating":4.7,"reviews":886,"types":["Fine dining restaurant","Asian restaurant","Fusion restaurant","Restaurant"],"address":"4 St James's Mkt, London, SW1Y 4AH, United Kingdom","operating_hours":{"saturday":"5–9:30 PM","sunday":"Closed","monday":"Closed","tuesday":"5–9:30 PM","wednesday":"12–9:30 PM","thursday":"12–9:30 PM","friday":"5–9:30 PM"},"description":"Stylish option for seasonal small plates. Hip, wood-hued eatery serving artfully plated seasonal flavors from Australia to India & Ireland.","service_options":{"dine_in":True}},{"data_id":"0x48761cb295f6ff5f:0xb3e4152c8e522a3c","category":"lunch","position":8,"title":"Duck & Waffle","gps_coordinates":{"latitude":51.5162529,"longitude":-0.0811942},"rating":4.3,"reviews":12385,"types":["Modern European restaurant","Breakfast restaurant","British restaurant","Brunch restaurant","Cocktail bar","Restaurant"],"address":"110 Bishopsgate, London, EC2N 4AY, United Kingdom","operating_hours":{"saturday":"Open 24 hours","sunday":"Open 24 hours","monday":"Open 24 hours","tuesday":"Open 24 hours","wednesday":"Open 24 hours","thursday":"Open 24 hours","friday":"Open 24 hours"},"description":"All-day British menu & 40th-floor views. British & European cuisine 24/7 in a modern 40th-floor space that has floor-to-ceiling windows.","service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x487604cc0debafed:0xe8b33b595e8b2176","category":"lunch","position":9,"title":"Flat Iron Covent Garden","gps_coordinates":{"latitude":51.510794999999995,"longitude":-0.1240732},"rating":4.6,"reviews":8227,"types":["Steak house"],"address":"17-18 Henrietta St, London, WC2E 8QH, United Kingdom","operating_hours":{"saturday":"12–11:30 PM","sunday":"12–10:30 PM","monday":"12–10:30 PM","tuesday":"12–10:30 PM","wednesday":"12–11 PM","thursday":"12–11 PM","friday":"12–11:30 PM"},"service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x487604cd93d1854b:0x4c9cea17f5145e54","category":"lunch","position":10,"title":"Steak and Company - Leicester Square","gps_coordinates":{"latitude":51.509812499999995,"longitude":-0.1285754},"rating":4.4,"reviews":4929,"types":["Steak house","Breakfast restaurant","Brunch restaurant","Family restaurant","Halal restaurant","Lunch restaurant","Restaurant"],"address":"3-5 Irving St, London, WC2H 0HA, United Kingdom","operating_hours":{"saturday":"10 AM–12 AM","sunday":"10 AM–11 PM","monday":"10 AM–11 PM","tuesday":"10 AM–11 PM","wednesday":"10 AM–11 PM","thursday":"10 AM–11 PM","friday":"10 AM–12 AM"},"description":"Brasserie-style steak restaurant. Steak served on hot stones in simply-decorated brasserie with exposed bricks and outdoor seats.","service_options":{"dine_in":True,"delivery":False}}],[{"data_id":"0x487604d15cac84af:0x5e1284e7a3e3e42b","category":"dinner","position":1,"title":"Scully St James's","gps_coordinates":{"latitude":51.508665,"longitude":-0.1330131},"rating":4.7,"reviews":886,"types":["Fine dining restaurant","Asian restaurant","Fusion restaurant","Restaurant"],"address":"4 St James's Mkt, London, SW1Y 4AH, United Kingdom","operating_hours":{"saturday":"5–9:30 PM","sunday":"Closed","monday":"Closed","tuesday":"5–9:30 PM","wednesday":"12–9:30 PM","thursday":"12–9:30 PM","friday":"5–9:30 PM"},"description":"Stylish option for seasonal small plates. Hip, wood-hued eatery serving artfully plated seasonal flavors from Australia to India & Ireland.","service_options":{"dine_in":True}},{"data_id":"0x4876053998f43547:0x60f3fd42f231a0fa","category":"dinner","position":2,"title":"Dinner by Heston Blumenthal","gps_coordinates":{"latitude":51.502161,"longitude":-0.159964},"rating":4.6,"reviews":1941,"types":["British restaurant","Fine dining restaurant","Modern European restaurant","Restaurant"],"address":"66 Knightsbridge, London, SW1X 7LA, United Kingdom","operating_hours":{"saturday":"12–2:30 PM","sunday":"12–2:30 PM","monday":"12–2 PM","tuesday":"12–2 PM","wednesday":"12–2 PM","thursday":"12–2 PM","friday":"12–2:30 PM"},"description":"British culinary history-inspired dining. Elegant, contemporary dining room in opulent hotel, for a menu inspired by British culinary history.","service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x4876057bfdc4509f:0xae7716829398dce8","category":"dinner","position":3,"title":"HIDE","gps_coordinates":{"latitude":51.5061931,"longitude":-0.1444369},"rating":4.5,"reviews":3053,"types":["Modern European restaurant","Fine dining restaurant","Restaurant"],"address":"85 Piccadilly, London, W1J 7NB, United Kingdom","operating_hours":{"saturday":"9–11:15 AM","sunday":"9–11:15 AM","monday":"7–10:45 AM","tuesday":"7–10:45 AM","wednesday":"7–10:45 AM","thursday":"7–10:45 AM","friday":"7–10:45 AM"},"description":"All-day, modern European restaurant. A three floor space in a contemporary setting with elevated morning to late-night dining options.","service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x4876101d34506f7b:0x8e76a34fff31a9e4","category":"dinner","position":4,"title":"The Ledbury","gps_coordinates":{"latitude":51.516655,"longitude":-0.200063},"rating":4.7,"reviews":1504,"types":["Modern European restaurant","Fine dining restaurant"],"address":"127 Ledbury Rd, London, W11 2AQ, United Kingdom","operating_hours":{"saturday":"12–1:30 PM","sunday":"Closed","monday":"Closed","tuesday":"6–9:15 PM","wednesday":"6–9:15 PM","thursday":"6–9:15 PM","friday":"12–1:30 PM"},"description":"Innovative French fare in tranquil space. Chef Brett Graham's innovative cooking, paired with fine wines in a smart, modern setting.","service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x487604cae7c2496d:0xb6ad06d63e339ce2","category":"dinner","position":5,"title":"Rules","gps_coordinates":{"latitude":51.510833,"longitude":-0.1231694},"rating":4.5,"reviews":2652,"types":["British restaurant","Bar","Country food restaurant","English restaurant","Meat dish restaurant","Traditional restaurant"],"address":"34-35 Maiden Ln, London, WC2E 7LB, United Kingdom","operating_hours":{"saturday":"12–11 PM","sunday":"12–10 PM","monday":"Closed","tuesday":"12–10 PM","wednesday":"12–10 PM","thursday":"12–10 PM","friday":"12–11 PM"},"description":"British menu at city's oldest restaurant. Established in 1798, serving classic British food (especially game) in Edwardian surrounds.","service_options":{"dine_in":True,"takeout":True,"delivery":False}},{"data_id":"0x48761b2b657c41e5:0x5593682c9b218977","category":"dinner","position":6,"title":"Berners Tavern","gps_coordinates":{"latitude":51.5166544,"longitude":-0.1361045},"rating":4.5,"reviews":2192,"types":["British restaurant","Fine dining restaurant","Modern British restaurant"],"address":"10 Berners St, London, W1T 3NP, United Kingdom","operating_hours":{"saturday":"7–10:45 AM","sunday":"7–10 AM","monday":"7–10 AM","tuesday":"7–10 AM","wednesday":"7–10 AM","thursday":"7–10 AM","friday":"7–10 AM"},"description":"Upmarket British food in designer hotel. Jason Atherton's upmarket Modern British restaurant in Ian Schrager's London Edition Hotel.","service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x48760529d30fc857:0xd0c0725a24b3c96e","category":"dinner","position":7,"title":"The Ritz Restaurant","gps_coordinates":{"latitude":51.506921299999995,"longitude":-0.14197369999999998},"rating":4.6,"reviews":762,"types":["Fine dining restaurant","British restaurant","Modern British restaurant"],"address":"150 Piccadilly, London, W1J 9BR, United Kingdom","operating_hours":{"saturday":"7:30 AM–9 PM","sunday":"7:30 AM–9 PM","monday":"7:30 AM–9 PM","tuesday":"7:30 AM–9 PM","wednesday":"7:30 AM–9 PM","thursday":"7:30 AM–9 PM","friday":"7:30 AM–9 PM"},"description":"British fine dining in baroque opulence. High-end British–French dining in baroque-style  gilded salon with ceiling frescoes and chandeliers.","service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x487604cd93d1854b:0x4c9cea17f5145e54","category":"dinner","position":8,"title":"Steak and Company - Leicester Square","gps_coordinates":{"latitude":51.509812499999995,"longitude":-0.1285754},"rating":4.4,"reviews":4929,"types":["Steak house","Breakfast restaurant","Brunch restaurant","Family restaurant","Halal restaurant","Lunch restaurant","Restaurant"],"address":"3-5 Irving St, London, WC2H 0HA, United Kingdom","operating_hours":{"saturday":"10 AM–12 AM","sunday":"10 AM–11 PM","monday":"10 AM–11 PM","tuesday":"10 AM–11 PM","wednesday":"10 AM–11 PM","thursday":"10 AM–11 PM","friday":"10 AM–12 AM"},"description":"Brasserie-style steak restaurant. Steak served on hot stones in simply-decorated brasserie with exposed bricks and outdoor seats.","service_options":{"dine_in":True,"delivery":False}},{"data_id":"0x4876034c23cfb3d1:0x18f52c30fb245dec","category":"dinner","position":9,"title":"La Dame de Pic London","gps_coordinates":{"latitude":51.510117799999996,"longitude":-0.07797459999999999},"rating":4.6,"reviews":525,"types":["French restaurant","Bar","Fine dining restaurant","Restaurant","Wine bar"],"address":"10 Trinity Square, London, EC3N 4AJ, United Kingdom","operating_hours":{"saturday":"12–1:30 PM","sunday":"Closed","monday":"Closed","tuesday":"6–9 PM","wednesday":"6–9 PM","thursday":"6–9 PM","friday":"12–1:30 PM"},"description":"Gourmand French cooking in elegant space. Inventive, high-end French menus in a classy hotel venue with banquettes and dramatic lighting.","service_options":{"dine_in":True,"takeout":False,"delivery":False}},{"data_id":"0x48761cb295f6ff5f:0xb3e4152c8e522a3c","category":"dinner","position":10,"title":"Duck & Waffle","gps_coordinates":{"latitude":51.5162529,"longitude":-0.0811942},"rating":4.3,"reviews":12385,"types":["Modern European restaurant","Breakfast restaurant","British restaurant","Brunch restaurant","Cocktail bar","Restaurant"],"address":"110 Bishopsgate, London, EC2N 4AY, United Kingdom","operating_hours":{"saturday":"Open 24 hours","sunday":"Open 24 hours","monday":"Open 24 hours","tuesday":"Open 24 hours","wednesday":"Open 24 hours","thursday":"Open 24 hours","friday":"Open 24 hours"},"description":"All-day British menu & 40th-floor views. British & European cuisine 24/7 in a modern 40th-floor space that has floor-to-ceiling windows.","service_options":{"dine_in":True,"takeout":False,"delivery":False}}]]
    }
}

user_content_template = (
    f"This is a {extracted_info['days']} day trip starting from {extracted_info['startingDate']}, and the JSON file is {extracted_info['json']}"
)

chat_response = client.chat.complete(
    model=model,
    messages=[
        system_message,
        {
            "role": "user",
            "content": user_content_template,
        },
    ]
)

# Parse the output JSON into a dictionary
response_content = chat_response.choices[0].message.content
try:
    # Extract the JSON part from the response using regex
    json_match = re.search(r"```json\n(\{.*?\})\n```", response_content, re.DOTALL)
    if json_match:
        json_str = json_match.group(1)
        travel_plan = json.loads(json_str)
        print(travel_plan)
    else:
        raise ValueError("No JSON found in the response.")
except (json.JSONDecodeError, ValueError) as e:
    print("Failed to parse response as JSON:", e)
    print(response_content)